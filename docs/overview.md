# üëÄ Open Security Data Lake + Detections-as-Code  \n**Operationalizing OCSF + Sigma + Attack Simulation in AWS**  \n \n### Overview  \n \nThis project demonstrates how to operationalize modern detection engineering by combining three major trends in cloud security:  \n \n1. **Open Security Data Lakes (OCSF + AWS Security Lake)** ‚Äì Centralize and normalize telemetry using the Open Cybersecurity Schema Framework (OCSF) and Amazon Security Lake.  \n2. **Detections-as-Code (Sigma + CI/CD)** ‚Äì Manage detection logic as code for versioning, testing, and automated deployment.  \n3. **Attack Simulation & Validation (Stratus Red Team)** ‚Äì Continuously validate detection coverage by simulating real-world attack techniques in AWS.  \n \nThis repository brings these concepts together to create a self-contained detection engineering lab that you can run in your own AWS environment.  \n \n### Learning Objectives  \n \n- **Build a Security Data Lake:** Enable AWS Security Lake, route CloudTrail, VPC Flow, and Route53 logs into a unified OCSF schema.  \n- **Query Normalized Data:** Use Athena or Jupyter notebooks to explore and visualize OCSF-formatted events.  \n- **Author & Automate Detections:** Write Sigma rules and enforce validation through a GitHub Actions pipeline.  \n- **Validate with Real Attacks:** Run Stratus Red Team simulations to emulate adversary techniques and measure detection efficacy.  \n- **Measure Coverage:** Generate Markdown reports summarizing detection coverage and simulation results.  \n \n### Architecture  \n \n```mermaid  \ngraph TD  \n    A[AWS Sources (CloudTrail, VPC Flow, Route53)] --> B[Security Lake]  \n    B --> C[Normalize to OCSF Schema]  \n    C --> D[Analyze via Athena / Notebooks]  \n    D --> E[Author Sigma Rules]  \n    E --> F[CI/CD: Lint + Compile + Validate]  \n    F --> G[Deploy to SIEM or Security Lake Analytics]  \n    G --> H[Simulate Attacks with Stratus Red Team]  \n    H --> I[Generate Detection Coverage Report]  \n```  \n \n### Quickstart Flow  \n \n1. Clone this repository and navigate into it.  \n2. Run `bash datalake/enable-security-lake.sh` to enable Security Lake and enable default sources.  \n3. Run `python3 datalake/normalize-ocsf.py` to normalize sample CloudTrail events into OCSF.  \n4. Compile Sigma rules with `bash detections/ci/compile-to-splunk.sh`.  \n5. Run attack simulations with `bash simulations/tests/validate-detections.sh`.  \n6. Generate a detection coverage report with `python3 detections/ci/detection-report.py`.  \n \n### Repository Contents  \n \n| Path | Purpose |  \n|------|---------|  \n| `datalake/` | Scripts and configs to enable Security Lake and normalize data. |  \n| `detections/sigma/` | Sigma detection rules and mapping file. |  \n| `detections/ci/` | CI scripts to validate rules, compile them, and generate reports. |  \n| `simulations/` | Stratus Red Team scenarios and validation scripts. |  \n| `docs/` | Documentation and diagrams (this overview). |  \n \n### Example Coverage Output  \n \n| Rule | Scenario | Status | Coverage | Last Run |  \n|------|---------|-------|---------|---------|  \n| `s3-public-access.yml` | `aws.s3.bucket-enumeration` | ‚úÖ | 100% | 2025-11-09 |  \n| `iam-passrole-abuse.yml` | `aws.iam.passrole.misuse` | ‚ö†Ô∏è | 80% | 2025-11-09 |  \n \n### Integrations & Technologies  \n \n| Component | Purpose |  \n|----------|---------|  \n| **AWS Security Lake** | Central repository for normalized telemetry. |  \n| **OCSF Schema** | Common data model for multi-source security events. |  \n| **Sigma Rules** | Vendor-neutral detection format for cross-platform use. |  \n| **GitHub Actions** | Automate detection validation and deployment. |  \n| **Stratus Red Team** | Simulate attack scenarios for validation. |  \n \n### Why This Project Matters  \n \nModern Security Operations Centers are data-driven and code-driven. Detection rules should be version-controlled and automatically tested. Data should be normalized for analysis. This project provides a hands-on blueprint for building such a detection pipeline using open standards and AWS services, from ingesting logs to validating detection coverage with simulated attacks.  \n \n### References  \n \n- AWS re:Inforce 2025 ‚Äì Operationalizing Amazon Security Lake (hands-on).  \n- From Soup to Nuts: Building a Detection-as-Code Pipeline.  \n- How to Level Up Your SOC Skill with Sigma (compile + import to Splunk).  \n- Reproducing Common Attacks in the Cloud with Stratus Red Team.  \n- Open Cybersecurity Schema Framework (OCSF).  \n- MITRE ATT&CK Framework.  \n \n### License  \n \nThis project is licensed under the MIT License. See the LICENSE file for details.
